<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gudang LT.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .arrow {
            transition: transform 0.3s ease;
        }
        .arrow:hover {
            transform: translateY(10px);
        }
        .nav-link {
            transition: background-color 0.3s ease;
        }
        .nav-link:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        .mobile-menu {
            display: none;
        }
        @media (max-width: 1500px) {
            .desktop-menu {
                display: none;
            }
            .mobile-menu {
                display: block;
            }
        }
        .container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .form-group {
            margin-bottom: 1rem;
            position: relative;
        }
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }
        .form-group input, .form-group select {
            padding: 0.5rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.25rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #5a67d8;
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.3);
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .button-container button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            background-color: #3b82f6;
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-right: 0.5rem;
        }
        .button-container button:last-child {
            margin-right: 0;
        }
        .button-container button:hover {
            background-color: #336ac4;
        }
        .button-container button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.3);
        }
        .button-container button i {
            margin-right: 0.5rem;
        }
        .grid {
            display: grid;
            gap: 1rem;
        }
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        .md-grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        .md-grid-cols-9 {
            grid-template-columns: repeat(9, minmax(0, 1fr));
        }
        .md-col-span-2 {
            grid-column: span 2 / span 2;
        }
        .md-col-span-1 {
            grid-column: span 1 / span 1;
        }
        .small-input {
            max-width: 300px;
        }
        .spacer {
            margin-top: 2rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        table, th, td {
            border: 1px solid #cbd5e0;
            color: #ffffff
        }
        th, td {
            padding: 0.5rem;
            text-align: center;
        }
        th {
            background-color: #005cef;
            font-weight: 700;
        }
        .msku1 {
            width: 250px;
        }
        .msku2 {
            width: 250px;
        }
        .msku3 {
    	    color: #000000; /* Warna teks hitam */
            width: 100%;
        }
        .msku4 {
    	    color: #000000; /* Warna teks hitam */
            width: 150px;
            -moz-appearance: textfield; /* Firefox */
        }
        .msku4::-webkit-outer-spin-button,
        .msku4::-webkit-inner-spin-button {
            -webkit-appearance: none; /* Chrome, Safari, Edge */
            margin: 0;
        }
        .msku5 {
    	    color: #000000; /* Warna teks hitam */
            width: 150px;
        }
        .msku6 {
    	    color: #000000; /* Warna teks hitam */
            width: 250px;
        }
        .msku7 {
    	    color: #000000; /* Warna teks hitam */
            width: 150px;
        }
        .msku8 {
    	    color: #000000; /* Warna teks hitam */
            width: 100%;
        }
        .msku9 {
    	    color: #000000; /* Warna teks hitam */
            width: 150px;
        }
        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background-color: #ffffff;
            border: 1px solid #cbd5e0;
            border-radius: 0.25rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            z-index: 10;
            display: none;
            text-align: left; /* Menambahkan text-align: left untuk meratakan teks ke kiri */
        }
        .dropdown-list.active {
            display: block;
        }
        .dropdown-item {
            padding: 0.5rem;
            cursor: pointer;
            color: #000000;
        }
        .dropdown-item:hover, .dropdown-item.highlighted {
            background-color: #e2e8f0;
        }
        .table-header {
            background-color: #005cef;
            color: white;
        }
        .col-nama-produk { width: 20%; }
        .col-jumlah { width: 10%; }
        .col-type { width: 10%; }
        .col-rak { width: 10%; }
        .col-packing { width: 20%; }
        .col-stok-tersedia { width: 10%; }
        .col-aksi { width: 7%; }
        .mobile-menu {
            display: none;
        }
        @media (max-width: 768px) {
            .desktop-menu {
                display: none;
            }
            .mobile-menu {
                display: block;
            }
        }
        .button {
            width: 150px; /* Set a fixed width for the buttons */
        }
        .dropdown {
            position: relative;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            z-index: 1;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
        }
        .dropdown-content div {
            padding: 8px;
            cursor: pointer;
        }
        .dropdown-content div:hover, .dropdown-content .highlighted {
            background-color: #f1f1f1;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
        }
        .invalid {
            border-color: red;
        }
        /* Pastikan ini di bawah Tailwind CSS */
        .max-w-screen-lg {
            max-width: 1500px; /* Mengubah max-width menjadi 1500px */
        }
    </style>
</head>
<body class="bg-white text-black">
    <header class="flex justify-between items-center p-6">
        <div class="text-xl font-bold">GUDANG LT.5</div>
        <nav class="space-x-8">
            <a href="home.html" class="text-black nav-link p-2">Home</a>
            <a href="stok-barang.html" class="text-black nav-link p-2">Stok Barang</a>
            <a href="stok-masuk.html" class="text-blue-600 nav-link p-2">Stok Masuk</a>
            <a href="stok-keluar.html" class="text-black nav-link p-2">Stok Keluar</a>
            <a href="riwayat.html" class="text-black nav-link p-2">Riwayat</a>
            <a href="semua-rak.html" class="text-black nav-link p-2">Semua Rak</a>
            <a href="input-sku.html" class="text-black nav-link p-2">Input SKU</a>
            <a href="data-so.html" class="text-black nav-link p-2">Data S.O</a>
            <a href="contact.html" class="text-black nav-link p-2">Contact</a>
        </nav>
        <div class="mobile-menu">
            <button id="menuButton" class="text-black">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </div>
    </header>
    <div id="mobileNav" class="hidden flex flex-col space-y-4 p-6">
        <a href="home.html" class="text-black nav-link p-2">Home</a>
        <a href="stok-barang.html" class="text-blue-600 nav-link p-2">Stok Barang</a>
        <a href="stok-masuk.html" class="text-black nav-link p-2">Stok Masuk</a>
        <a href="stok-keluar.html" class="text-black nav-link p-2">Stok Keluar</a>
        <a href="riwayat.html" class="text-black nav-link p-2">Riwayat</a>
        <a href="semua-rak.html" class="text-black nav-link p-2">Semua Rak</a>
        <a href="input-sku.html" class="text-black nav-link p-2">Input SKU</a>
        <a href="data-so.html" class="text-black nav-link p-2">Data S.O</a>
        <a href="contact.html" class="text-black nav-link p-2">Contact</a>
    </div>
<hr class="border-t-2 border-black">
<div class="container max-w-screen-lg mx-auto px-4" style="
    max-width: 1500px;
">
    <h2>Form Input MSKU</h2>
    <form id="mskuForm" autocomplete="off">
<div class="form-group">
    <label for="msku1">MSKU 1:</label>
    <input type="date" id="msku1" name="msku1" class="msku1" required autocomplete="off">
</div>
<div class="form-group">
    <label for="msku2">MSKU 2:</label>
    <input type="text" id="msku2" name="msku2" class="msku2" required autocomplete="off" readonly>
</div>
<div class="form-group">
    <label for="msku6">MSKU 6:</label>
    <select id="msku6" name="msku6" class="msku6" required>
        <option value="" disabled selected>Pilih Data Gudang</option>
    </select>
</div>
        <div class="button-container">
            <button type="button" onclick="addRow()">
                <i class="fas fa-plus"></i>Tambah Baris
            </button>
            <button type="button" onclick="addTwentyRows()">
                <i class="fas fa-plus"></i>Tambah 20 Baris
            </button>
            <button type="button" onclick="submitForm()">
                <i class="fas fa-paper-plane"></i>Submit
            </button>
        </div>
        <div class="spacer"></div>
        <table id="mskuTable">
            <thead>
                <tr>
                    <th>MSKU 3</th>
                    <th style="width: 150px;">MSKU 4</th>
                    <th style="width: 150px;">MSKU 5</th>
                    <th style="width: 150px;">MSKU 7</th>
                    <th>MSKU 8</th>
                    <th style="width: 150px;">MSKU 9</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="form-group">
                            <input type="text" id="msku3" name="msku3" class="msku3 w-full" required autocomplete="off" oninput="filterDropdown(this); checkAndFetchPacking(this)">
                            <div class="dropdown-list" id="dropdownList"></div>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <input type="number" id="msku4" name="msku4" class="msku4 w-full" required autocomplete="off">
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <input type="text" id="msku5" name="msku5" class="msku5 w-full" value="IN" readonly>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <select id="msku7" name="msku7" class="msku7 w-full" required autocomplete="off" onchange="checkAndFetchPacking(this)">
                                <option value="" disabled selected>Pilih Rak</option>
                            </select>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <input type="text" id="msku8" name="msku8" class="msku8 w-full" required autocomplete="off">
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <input type="text" id="msku9" name="msku9" class="msku9 w-full" required autocomplete="off">
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>

<script>
        const apiKey = 'AIzaSyCb9GeLx7UcqkvXj3Oy3F6e1B9XAvMLE4A';
        const spreadsheetId = '1hJVqPsSUdo5wyJ7yVO_Fs-UkHrsQDIhvX4EMejgbAXc';
        const packingRange = 'datapacking!A2:D';
        const gudangRange = 'datagudang!A2:A';
	const rakRange = 'inputrak!A2:A';
	const packingTotalRange = 'packingtotal!A2:D'; // Misalnya, kita ambil dari A2 sampai D
	const packingTotalUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${packingTotalRange}?key=${apiKey}`;
        const packingUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${packingRange}?key=${apiKey}`;
        const gudangUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${gudangRange}?key=${apiKey}`;
	const rakUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${rakRange}?key=${apiKey}`;

  function submitForm() {
    const table = document.getElementById("mskuTable");
    const rows = table.getElementsByTagName('tr');  // Ambil semua baris dalam tabel
    const formData = new FormData();

    // Menambahkan data MSKU 1, 2, dan 6 secara manual untuk pengiriman
    const msku1 = document.getElementById('msku1').value;
    const msku2 = document.getElementById('msku2').value;
    const msku6 = document.getElementById('msku6').value;

    // Menambahkan MSKU 1, 2, dan 6 ke dalam FormData
    formData.append('msku1', msku1);
    formData.append('msku2', msku2);
    formData.append('msku6', msku6);

    // Ambil data dari setiap baris dan tambahkan ke formData
    for (let i = 1; i < rows.length; i++) {  // Mulai dari 1 untuk melewati header
      const cells = rows[i].getElementsByTagName('td');
      formData.append('msku3_' + i, cells[0].querySelector('input').value);
      formData.append('msku4_' + i, cells[1].querySelector('input').value);
      formData.append('msku5_' + i, cells[2].querySelector('input').value);
      formData.append('msku7_' + i, cells[3].querySelector('select').value);
      formData.append('msku8_' + i, cells[4].querySelector('input').value);
      formData.append('msku9_' + i, cells[5].querySelector('input').value);
    }

    // Mengirim data ke Google Apps Script
    fetch('https://script.google.com/macros/s/AKfycbx0MkQ64-NASueTViCYLqsC1wAJiRmZrpJoJzX1eb3kETBB0CYXpVDZhVVNm5qxwcCm/exec', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.result === 'success') {
        alert('Data berhasil dikirim!');
      } else {
        alert('Gagal mengirim data.');
      }
    })
    .catch(error => console.error('Error:', error));
  }

  // Fungsi untuk mengambil packing berdasarkan nama produk dan rak
  function fetchPackingByProductAndRak(msku3Value, msku7Value, inputMsku8) {
    fetch(packingTotalUrl)
      .then(response => response.json())
      .then(data => {
        const rows = data.values || [];
        let foundValue = '';

        // Mencari nilai yang sesuai dengan MSKU 3 dan MSKU 7
        for (const row of rows) {
          if (row[0] === msku3Value && row[1] === msku7Value) {
            foundValue = row[2]; // Ambil nilai dari kolom C (atau kolom yang sesuai)
            break;
          }
        }

        // Mengisi input MSKU 8 jika ditemukan
        inputMsku8.value = foundValue;
      })
      .catch(error => console.error('Error fetching packing data:', error));
  }

  // Fungsi untuk memeriksa dan mengambil data packing
  function checkAndFetchPacking(element) {
    const row = element.closest('tr');
    const msku3Input = row.querySelector('input[name="msku3"]');
    const msku7Select = row.querySelector('select[name="msku7"]');
    const msku8Input = row.querySelector('input[name="msku8"]');

    if (msku3Input.value && msku7Select.value) {
      fetchPackingByProductAndRak(msku3Input.value, msku7Select.value, msku8Input);
    }
  }


// Modifikasi fungsi addRow
function addRow() {
    const table = document.getElementById("mskuTable").getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();

    // Membuat sel untuk setiap input
    const cells = [
        { id: 'msku3', class: 'msku3', type: 'text', required: true, readonly: false, value: '', isDropdown: true },
        { id: 'msku4', class: 'msku4', type: 'number', required: true, readonly: false, value: '' },
        { id: 'msku5', class: 'msku5', type: 'text', required: true, readonly: true, value: 'IN' },
        { id: 'msku7', class: 'msku7', type: 'select', required: true, readonly: false, value: '' },
        { id: 'msku8', class: 'msku8', type: 'text', required: true, readonly: false, value: '' },
        { id: 'msku9', class: 'msku9', type: 'text', required: true, readonly: false, value: '' }
    ];

    cells.forEach(cell => {
        const newCell = newRow.insertCell();
        newCell.classList.add('form-group'); // Menambahkan kelas form-group ke setiap sel

        if (cell.isDropdown) {
            // Untuk input MSKU 3
            newCell.innerHTML = `
                <input type="${cell.type}" id="${cell.id}_${table.rows.length}" name="${cell.id}" class="${cell.class} w-full" required="${cell.required}" autocomplete="off" oninput="filterDropdown(this); checkAndFetchPacking(this)">
                <div class="dropdown-list"></div>
            `;
            // Panggil fungsi untuk mengisi dropdown MSKU 3 dengan data
            fetchPackingData(); // Mengisi dropdown MSKU 3
        } else if (cell.id === 'msku7') {
            // Untuk dropdown rak MSKU 7
            newCell.innerHTML = `
                <select id="${cell.id}_${table.rows.length}" name="${cell.id}" class="${cell.class} w-full" required="${cell.required}" autocomplete="off" onchange="checkAndFetchPacking(this)">
                    <option value="" disabled selected>Pilih Rak</option>
                </select>
            `;
        } else {
            // Untuk input lainnya
            newCell.innerHTML = `<input type="${cell.type}" id="${cell.id}_${table.rows.length}" name="${cell.id}" class="${cell.class} w-full" value="${cell.value}" ${cell.readonly ? 'readonly' : ''} required="${cell.required}">`;
        }
    });

    // Panggil fungsi untuk mengisi dropdown MSKU 7 jika diperlukan
    fetchRakData(newRow.querySelector('.msku7')); // Panggil fungsi untuk mengisi dropdown rak
}

  function addTwentyRows() {
    for (let i = 0; i < 20; i++) {
      addRow();
    }
  }

  function updateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    document.getElementById('msku2').value = timeString;
  }

  setInterval(updateTime, 1000);
  window.onload = updateTime;

  function fetchGudangData() {
    fetch(gudangUrl)
      .then(response => response.json())
      .then(data => {
        const gudangSelect = document.getElementById('msku6');
        data.values.forEach(value => {
          const option = document.createElement('option');
          option.value = value[0];
          option.textContent = value[0];
          gudangSelect.appendChild(option);
        });
      })
      .catch(error => console.error('Error fetching data:', error));
  }

  // Tambahkan fungsi untuk mengambil data rak
  function fetchRakData(selectElement) {
    fetch(rakUrl)
      .then(response => response.json())
      .then(data => {
        data.values.forEach(value => {
          const option = document.createElement('option');
          option.value = value[0];
          option.textContent = value[0];
          selectElement.appendChild(option);
        });
      })
      .catch(error => console.error('Error fetching rak data:', error));
  }

  function fetchPackingData() {
    fetch(packingUrl)
      .then(response => response.json())
      .then(data => {
        const packingData = data.values.map(row => row[0]); // Assuming the relevant data is in the first column
        const dropdownLists = document.querySelectorAll('.dropdown-list');
        dropdownLists.forEach(dropdownList => {
          dropdownList.innerHTML = ''; // Clear existing items
          packingData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'dropdown-item';
            div.textContent = item;
            div.onclick = () => {
              const input = dropdownList.previousElementSibling;
              input.value = item;
              dropdownList.classList.remove('active');
              checkAndFetchPacking(input); // Panggil fungsi untuk memeriksa dan mengambil data packing
            };
            dropdownList.appendChild(div);
          });
        });
      })
      .catch(error => console.error('Error fetching data:', error));
  }

  function filterDropdown(input) {
    const filter = input.value.toLowerCase();
    const dropdownList = input.nextElementSibling;
    const items = dropdownList.getElementsByClassName('dropdown-item');
    let firstVisibleItem = null;

    // Reset semua item
    Array.from(items).forEach(item => {
      item.style.display = ''; // Tampilkan semua item
      item.classList.remove('highlighted'); // Hapus highlight dari semua item
    });

    // Menyaring dan menandai item yang cocok
    Array.from(items).forEach(item => {
      if (item.textContent.toLowerCase().includes(filter)) {
        item.style.display = ''; // Tampilkan item yang cocok
        if (!firstVisibleItem) {
          firstVisibleItem = item; // Simpan item pertama yang terlihat
        }
      } else {
        item.style.display = 'none'; // Sembunyikan item yang tidak cocok
      }
    });

    // Jika ada item yang terlihat, highlight item pertama
    if (firstVisibleItem) {
      firstVisibleItem.classList.add('highlighted'); // Highlight item pertama yang cocok
    }

    dropdownList.classList.add('active'); // Tampilkan dropdown
  }

  document.addEventListener('keydown', function(event) {
    const dropdownLists = document.querySelectorAll('.dropdown-list');
    dropdownLists.forEach(dropdownList => {
      if (dropdownList.classList.contains('active')) {
        const highlightedItem = dropdownList.querySelector('.highlighted');
        let newHighlightedItem;

        if (event.key === 'ArrowDown') {
          newHighlightedItem = highlightedItem ? highlightedItem.nextElementSibling : dropdownList.firstElementChild;
          while (newHighlightedItem && newHighlightedItem.style.display === 'none') {
            newHighlightedItem = newHighlightedItem.nextElementSibling;
          }
          if (!newHighlightedItem) {
            newHighlightedItem = dropdownList.firstElementChild; // Loop back to the first item
          }
        } else if (event.key === 'ArrowUp') {
          newHighlightedItem = highlightedItem ? highlightedItem.previousElementSibling : dropdownList.lastElementChild;
          while (newHighlightedItem && newHighlightedItem.style.display === 'none') {
            newHighlightedItem = newHighlightedItem.previousElementSibling;
          }
          if (!newHighlightedItem) {
            newHighlightedItem = dropdownList.lastElementChild; // Loop back to the last item
          }
        } else if (event.key === 'Enter' && highlightedItem) {
          highlightedItem.click();
          event.preventDefault(); // Mencegah form dari submit jika dalam form
        } else if (event.key === 'Tab' && highlightedItem) {
          highlightedItem.click();
        }

        if (newHighlightedItem) {
          if (highlightedItem) {
            highlightedItem.classList.remove('highlighted');
          }
          newHighlightedItem.classList.add('highlighted');
          newHighlightedItem.scrollIntoView({ block: 'nearest' });
        }
      }
    });
  });

  window.onload = function() {
    updateTime();
    fetchGudangData();
    fetchPackingData();
    fetchRakData(document.querySelector('select[name="msku7"]')); // Panggil fungsi untuk mengambil data rak untuk baris pertama
  };
</script>
</body>
</html>
